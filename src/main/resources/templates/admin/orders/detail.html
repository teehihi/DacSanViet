<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chi Ti·∫øt ƒê∆°n H√†ng - ƒê·∫∑c S·∫£n Vi·ªát Admin</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <link rel="stylesheet" th:href="@{/css/admin-dashboard.css}">
</head>
<body>
    <!-- Sidebar -->
    <div th:replace="~{admin/fragments/sidebar :: sidebar}"></div>
    
    <!-- Main Content -->
    <div class="admin-main">
        <!-- Header -->
        <div class="admin-header">
            <div class="header-title">
                <h1>Chi Ti·∫øt ƒê∆°n H√†ng</h1>
                <p>Xem v√† qu·∫£n l√Ω th√¥ng tin ƒë∆°n h√†ng</p>
            </div>
            <div class="header-actions">
                <button class="btn btn-secondary" onclick="window.location.href='/admin/orders'">
                    <i class="bi bi-arrow-left"></i>
                    Quay L·∫°i
                </button>
                <button class="btn btn-primary" th:onclick="'updateOrderStatus(' + ${order.id} + ')'">
                    <i class="bi bi-pencil"></i>
                    C·∫≠p Nh·∫≠t ƒê∆°n H√†ng
                </button>
            </div>
        </div>

        <!-- Order Info Cards -->
        <div class="order-detail-grid">
            <!-- Left Column -->
            <div class="order-detail-left">
                <!-- Order Status Card -->
                <div class="card">
                    <div class="card-header">
                        <h5>Th√¥ng Tin ƒê∆°n H√†ng</h5>
                    </div>
                    <div class="card-body">
                        <div class="info-item-grid">
                            <div class="info-item">
                                <div class="info-label">M√£ ƒê∆°n H√†ng</div>
                                <div class="info-value" th:text="${order.orderNumber}">ORD123456</div>
                            </div>
                            <div class="info-item">
                                <div class="info-label">Ng√†y ƒê·∫∑t</div>
                                <div class="info-value" th:text="${#temporals.format(order.orderDate, 'dd/MM/yyyy HH:mm')}">24/12/2024 15:30</div>
                            </div>
                            <div class="info-item">
                                <div class="info-label">Tr·∫°ng Th√°i ƒê∆°n H√†ng</div>
                                <div class="info-value">
                                    <span th:class="'status-badge status-' + ${order.status == 'PENDING' ? 'pending' : 
                                                                                order.status == 'CONFIRMED' ? 'processing' :
                                                                                order.status == 'PROCESSING' ? 'processing' :
                                                                                order.status == 'SHIPPED' ? 'delivered' :
                                                                                order.status == 'DELIVERED' ? 'active' :
                                                                                order.status == 'CANCELLED' ? 'cancelled' : 'pending'}"
                                          th:text="${order.status == 'PENDING' ? 'Ch·ªù X√°c Nh·∫≠n' :
                                                   order.status == 'CONFIRMED' ? 'ƒê√£ X√°c Nh·∫≠n' :
                                                   order.status == 'PROCESSING' ? 'ƒêang X·ª≠ L√Ω' :
                                                   order.status == 'SHIPPED' ? 'ƒêang Giao' :
                                                   order.status == 'DELIVERED' ? 'ƒê√£ Giao' :
                                                   order.status == 'CANCELLED' ? 'ƒê√£ H·ªßy' : order.status}">
                                        Ch·ªù X·ª≠ L√Ω
                                    </span>
                                </div>
                            </div>
                            <div class="info-item">
                                <div class="info-label">Tr·∫°ng Th√°i Thanh To√°n</div>
                                <div class="info-value">
                                    <span th:class="'status-badge status-' + ${order.paymentStatus == 'PENDING' ? 'pending' :
                                                                                order.paymentStatus == 'COMPLETED' ? 'active' :
                                                                                order.paymentStatus == 'FAILED' ? 'cancelled' : 'pending'}"
                                          th:text="${order.paymentStatus == 'PENDING' ? 'Ch·ªù Thanh To√°n' :
                                                   order.paymentStatus == 'COMPLETED' ? 'ƒê√£ Thanh To√°n' :
                                                   order.paymentStatus == 'FAILED' ? 'Thanh To√°n Th·∫•t B·∫°i' : order.paymentStatus}">
                                        Ch·ªù Thanh To√°n
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Customer Info Card -->
                <div class="card">
                    <div class="card-header">
                        <h5><i class="bi bi-person-circle me-2"></i>Th√¥ng Tin Kh√°ch H√†ng</h5>
                    </div>
                    <div class="card-body">
                        <div class="info-item mb-3">
                            <div class="info-label">T√™n Kh√°ch H√†ng</div>
                            <div class="info-value" th:text="${order.customerName}">Nguy·ªÖn VƒÉn A</div>
                        </div>
                        <div class="info-item mb-3">
                            <div class="info-label">Email</div>
                            <div class="info-value" th:text="${order.customerEmail}">email@example.com</div>
                        </div>
                        <div class="info-item mb-3">
                            <div class="info-label">S·ªë ƒêi·ªán Tho·∫°i</div>
                            <div class="info-value" th:text="${order.customerPhone}">0123456789</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">ƒê·ªãa Ch·ªâ Giao H√†ng</div>
                            <div class="info-value" th:text="${order.shippingAddressText}">123 ƒê∆∞·ªùng ABC, Qu·∫≠n 1, TP.HCM</div>
                        </div>
                    </div>
                </div>

                <!-- Products Card -->
                <div class="card">
                    <div class="card-header">
                        <h5><i class="bi bi-box-seam me-2"></i>S·∫£n Ph·∫©m</h5>
                    </div>
                    <div class="card-body" style="padding: 0;">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>S·∫£n Ph·∫©m</th>
                                    <th style="text-align: center;">S·ªë L∆∞·ª£ng</th>
                                    <th style="text-align: right;">ƒê∆°n Gi√°</th>
                                    <th style="text-align: right;">T·ªïng</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr th:each="item : ${order.orderItems}">
                                    <td>
                                        <div style="display: flex; align-items: center; gap: 1rem;">
                                            <img th:src="${item.productImageUrl}" 
                                                 th:alt="${item.productName}"
                                                 style="width: 50px; height: 50px; object-fit: cover; border-radius: 8px;"
                                                 onerror="this.src='data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%2250%22 height=%2250%22%3E%3Crect fill=%22%23ddd%22 width=%2250%22 height=%2250%22/%3E%3Ctext x=%2250%25%22 y=%2250%25%22 dominant-baseline=%22middle%22 text-anchor=%22middle%22 fill=%22%23999%22 font-size=%2210%22%3ENo Image%3C/text%3E%3C/svg%3E'">
                                            <span th:text="${item.productName}">S·∫£n ph·∫©m</span>
                                        </div>
                                    </td>
                                    <td style="text-align: center;" th:text="${item.quantity}">1</td>
                                    <td style="text-align: right;" th:text="${#numbers.formatDecimal(item.unitPrice, 0, 'COMMA', 0, 'POINT')} + '‚Ç´'">100.000‚Ç´</td>
                                    <td style="text-align: right; font-weight: 600;" th:text="${#numbers.formatDecimal(item.totalPrice, 0, 'COMMA', 0, 'POINT')} + '‚Ç´'">100.000‚Ç´</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Right Column -->
            <div class="order-detail-right">
                <!-- Shipping Info Card -->
                <div class="card">
                    <div class="card-header">
                        <h5><i class="bi bi-truck me-2"></i>V·∫≠n Chuy·ªÉn</h5>
                    </div>
                    <div class="card-body">
                        <div class="info-item mb-3">
                            <div class="info-label">Ph∆∞∆°ng Th·ª©c V·∫≠n Chuy·ªÉn</div>
                            <div class="info-value">
                                <span th:if="${order.shippingMethod == 'EXPRESS_5H'}">‚ö° Giao Nhanh 5H</span>
                                <span th:if="${order.shippingMethod == 'STANDARD'}">üì¶ Giao Ti√™u Chu·∫©n</span>
                                <span th:if="${order.shippingMethod != 'EXPRESS_5H' && order.shippingMethod != 'STANDARD'}" th:text="${order.shippingMethod}">Ch∆∞a ch·ªçn</span>
                            </div>
                        </div>
                        <div class="info-item mb-3" th:if="${order.shippingCarrier}">
                            <div class="info-label">ƒê∆°n V·ªã V·∫≠n Chuy·ªÉn</div>
                            <div class="info-value" th:text="${order.shippingCarrier}">GHN</div>
                        </div>
                        <div class="info-item mb-3" th:if="${order.trackingNumber}">
                            <div class="info-label">M√£ V·∫≠n ƒê∆°n</div>
                            <div class="info-value" th:text="${order.trackingNumber}">TRACK123456</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Ph√≠ V·∫≠n Chuy·ªÉn</div>
                            <div class="info-value" th:text="${#numbers.formatDecimal(order.shippingFee, 0, 'COMMA', 0, 'POINT')} + '‚Ç´'">30.000‚Ç´</div>
                        </div>
                    </div>
                </div>

                <!-- Payment Info Card -->
                <div class="card">
                    <div class="card-header">
                        <h5><i class="bi bi-credit-card me-2"></i>Thanh To√°n</h5>
                    </div>
                    <div class="card-body">
                        <div class="info-item mb-3">
                            <div class="info-label">Ph∆∞∆°ng Th·ª©c Thanh To√°n</div>
                            <div class="info-value">
                                <span th:if="${order.paymentMethod == 'COD'}">üíµ Thanh to√°n khi nh·∫≠n h√†ng</span>
                                <span th:if="${order.paymentMethod == 'BANK_TRANSFER'}">üè¶ Chuy·ªÉn kho·∫£n ng√¢n h√†ng</span>
                                <span th:if="${order.paymentMethod == 'MOMO'}">üì± V√≠ MoMo</span>
                                <span th:if="${order.paymentMethod == 'VNPAY'}">üí≥ VNPay</span>
                                <span th:if="${order.paymentMethod != 'COD' && order.paymentMethod != 'BANK_TRANSFER' && order.paymentMethod != 'MOMO' && order.paymentMethod != 'VNPAY'}" th:text="${order.paymentMethod}">Ch∆∞a ch·ªçn</span>
                            </div>
                        </div>
                        <div class="info-item mb-3">
                            <div class="info-label">T·∫°m T√≠nh</div>
                            <div class="info-value" th:text="${#numbers.formatDecimal(order.totalAmount - order.shippingFee, 0, 'COMMA', 0, 'POINT')} + '‚Ç´'">500.000‚Ç´</div>
                        </div>
                        <div class="info-item mb-3">
                            <div class="info-label">Ph√≠ V·∫≠n Chuy·ªÉn</div>
                            <div class="info-value" th:text="${#numbers.formatDecimal(order.shippingFee, 0, 'COMMA', 0, 'POINT')} + '‚Ç´'">30.000‚Ç´</div>
                        </div>
                        <div class="info-item" style="padding-top: 1rem; border-top: 2px solid var(--border-color);">
                            <div class="info-label" style="font-size: 1.1rem; font-weight: 700;">T·ªïng C·ªông</div>
                            <div class="info-value" style="font-size: 1.5rem; color: var(--primary-color); font-weight: 700;" 
                                 th:text="${#numbers.formatDecimal(order.totalAmount, 0, 'COMMA', 0, 'POINT')} + '‚Ç´'">530.000‚Ç´</div>
                        </div>
                    </div>
                </div>

                <!-- Notes Card -->
                <div class="card" th:if="${order.notes}">
                    <div class="card-header">
                        <h5><i class="bi bi-sticky me-2"></i>Ghi Ch√∫</h5>
                    </div>
                    <div class="card-body">
                        <p th:text="${order.notes}" style="margin: 0; white-space: pre-wrap;">Ghi ch√∫ ƒë∆°n h√†ng</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Edit Order Modal (reuse from orders/index.html) -->
        <div id="editOrderModal" class="modal">
            <div class="modal-content" style="max-width: 800px;">
                <div id="editOrderContent"></div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script th:inline="javascript">
        /*<![CDATA[*/
        // Import functions from admin-orders.js
        const orderId = /*[[${order.id}]]*/ 0;
        /*]]>*/
    </script>
    <script th:src="@{/js/admin-orders.js}"></script>
</body>
</html>
